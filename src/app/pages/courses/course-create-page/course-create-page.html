<div class="container">
  <h2>Crear Curso</h2>

  @if (errorMessage()) {
    <p class="error-message">{{ errorMessage() }}</p>
  }

  @if (successMessage()) {
    <p class="success-message">{{ successMessage() }}</p>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="course-form">

    <div class="form-field">
      <label for="name">Nombre del curso <span class="required">*</span></label>
      <input 
        type="text" 
        id="name"
        formControlName="name"
        [class.invalid]="submitted() && form.controls['name'].invalid"
        placeholder="Ej: Matem치tica I">
      @if (submitted() && form.controls['name'].invalid) {
        <small class="field-error">
          @if (form.controls['name'].errors?.['required']) {
            El nombre del curso es obligatorio
          }
        </small>
      }
    </div>

    <div class="form-field">
      <label for="school">Escuela <span class="required">*</span></label>
      <input 
        type="text" 
        id="school"
        formControlName="school"
        [class.invalid]="submitted() && form.controls['school'].invalid"
        placeholder="Ej: Escuela Secundaria N춿1">
      @if (submitted() && form.controls['school'].invalid) {
        <small class="field-error">
          @if (form.controls['school'].errors?.['required']) {
            La escuela es obligatoria
          }
        </small>
      }
    </div>

    <div class="form-field">
      <label for="description">Descripci칩n (opcional)</label>
      <textarea 
        id="description"
        rows="3" 
        formControlName="description"
        placeholder="Descripci칩n del curso..."></textarea>
    </div>

    <div class="form-field-group">
      <h3>Notas de Aprobaci칩n y Habilitaci칩n (opcional)</h3>
      <div class="form-field-row">
        <div class="form-field">
          <label for="approvalGrade">Nota de Aprobaci칩n (default)</label>
          <input 
            type="number" 
            id="approvalGrade"
            formControlName="approvalGrade"
            min="0"
            max="10"
            step="0.1"
            placeholder="Ej: 6.0"
            [class.invalid]="submitted() && form.controls['approvalGrade'].invalid">
          <small class="help-text">Nota m칤nima para aprobar (se usar치 como default para todas las evaluaciones)</small>
        </div>
        <div class="form-field">
          <label for="qualificationGrade">Nota de Habilitaci칩n (default)</label>
          <input 
            type="number" 
            id="qualificationGrade"
            formControlName="qualificationGrade"
            min="0"
            max="10"
            step="0.1"
            placeholder="Ej: 4.0"
            [class.invalid]="submitted() && form.controls['qualificationGrade'].invalid">
          <small class="help-text">Nota m칤nima para habilitar examen (se usar치 como default para todas las evaluaciones)</small>
        </div>
      </div>
    </div>

    <div class="form-field">
      <label>Importar estudiantes desde Excel (opcional)</label>
      <div class="file-import-section">
        <button type="button" (click)="openFilePicker()" class="btn-import" [disabled]="importing()">
          @if (importing()) {
            Importando...
          } @else {
            游늯 Seleccionar archivo Excel
          }
        </button>
        <input 
          type="file" 
          #fileInput
          accept=".xlsx,.xls"
          style="display: none"
          (change)="onFileSelected($event)">
        @if (selectedFileName()) {
          <span class="file-name">{{ selectedFileName() }}</span>
        }
      </div>
      <small class="help-text">
        El archivo Excel debe tener columnas: <strong>Nombre</strong>, <strong>Apellido</strong>, <strong>Email</strong>, Cel, Documento. 
        <strong>Nombre, Apellido y Email son obligatorias</strong>. Los emails deben tener formato v치lido.
      </small>
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="form.invalid || importing()" class="btn-submit">
        @if (importing()) {
          Creando curso e importando estudiantes...
        } @else {
          Guardar Curso
        }
      </button>
    </div>
  </form>
</div>
