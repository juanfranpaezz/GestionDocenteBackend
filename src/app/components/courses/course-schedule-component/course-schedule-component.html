<div class="schedule-container">
  <div class="schedule-header">
    <h3>Horarios del Curso</h3>
    <button type="button" class="btn-add" (click)="showAddForm()" [disabled]="loading()">
      ‚ûï Agregar Horario
    </button>
  </div>

  @if (errorMessage()) {
    <div class="error-message">
      {{ errorMessage() }}
    </div>
  }

  @if (showForm()) {
    <div class="schedule-form">
      <h4>{{ editingSchedule() ? 'Editar' : 'Agregar' }} Horario</h4>
      <form [formGroup]="scheduleForm" (ngSubmit)="saveSchedule()">
        <div class="form-row">
          <div class="form-group">
            <label>D√≠a de la semana:</label>
            <select formControlName="dayOfWeek" [class.invalid]="scheduleForm.get('dayOfWeek')?.invalid && scheduleForm.get('dayOfWeek')?.touched">
              <option value="">Seleccione un d√≠a</option>
              @for (day of daysOfWeek; track day.value) {
                <option [value]="day.value">{{ day.label }}</option>
              }
            </select>
            @if (scheduleForm.get('dayOfWeek')?.invalid && scheduleForm.get('dayOfWeek')?.touched) {
              <small class="field-error">El d√≠a es obligatorio</small>
            }
          </div>

          <div class="form-group">
            <label>Hora de inicio:</label>
            <input 
              type="time" 
              formControlName="startTime"
              [class.invalid]="scheduleForm.get('startTime')?.invalid && scheduleForm.get('startTime')?.touched"
            />
            @if (scheduleForm.get('startTime')?.invalid && scheduleForm.get('startTime')?.touched) {
              <small class="field-error">La hora de inicio es obligatoria</small>
            }
          </div>

          <div class="form-group">
            <label>Hora de fin:</label>
            <input 
              type="time" 
              formControlName="endTime"
              [class.invalid]="scheduleForm.get('endTime')?.invalid && scheduleForm.get('endTime')?.touched"
            />
            @if (scheduleForm.get('endTime')?.invalid && scheduleForm.get('endTime')?.touched) {
              <small class="field-error">La hora de fin es obligatoria</small>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="button" (click)="cancelForm()" [disabled]="loading()">Cancelar</button>
          <button type="submit" [disabled]="scheduleForm.invalid || loading()">
            {{ loading() ? 'Guardando...' : (editingSchedule() ? 'Actualizar' : 'Guardar') }}
          </button>
        </div>
      </form>
    </div>
  }

  @if (loading() && filteredSchedules().length === 0) {
    <div class="loading">Cargando horarios...</div>
  }

  @if (!loading() && filteredSchedules().length === 0 && !showForm()) {
    <div class="empty-state">
      <p>No hay horarios configurados para esta materia.</p>
      <p>Agrega un horario para que el sistema pueda redirigirte autom√°ticamente al iniciar sesi√≥n.</p>
    </div>
  }

  @if (filteredSchedules().length > 0) {
    <div class="schedules-list">
      <table class="schedules-table">
        <thead>
          <tr>
            <th>D√≠a</th>
            <th>Hora de inicio</th>
            <th>Hora de fin</th>
            <th>Duraci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (schedule of filteredSchedules(); track schedule.id) {
            <tr>
              <td><strong>{{ getDayLabel(schedule.dayOfWeek) }}</strong></td>
              <td>{{ formatTime(schedule.startTime) }}</td>
              <td>{{ formatTime(schedule.endTime) }}</td>
              <td>{{ calculateDuration(schedule.startTime, schedule.endTime) }}</td>
              <td class="actions">
                <button type="button" class="btn-edit" (click)="editSchedule(schedule)" [disabled]="loading()">
                  ‚úèÔ∏è Editar
                </button>
                <button type="button" class="btn-delete" (click)="deleteSchedule(schedule.id!)" [disabled]="loading()">
                  üóëÔ∏è Eliminar
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>

